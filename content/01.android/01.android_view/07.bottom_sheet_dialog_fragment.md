---
title: BottomSheetDialogFragmentを扱う
description: BottomSheetDialogFragmentでの実装方法について紹介・解説します。
navigation: true
draft: false
date: 2025-09-13T07:00:00+09:00
---

## BottomSheetDialogFragmentを使う

### 実装方法

1.  **`style`の追加**
2.  **`BottomSheetDialogFragment`のサブクラスの実装**

#### 1\. styleの追加

`styles.xml`ファイルに、`BottomSheetDialogFragment`のテーマを定義する。

```xml
<style name="BottomSheetDialogTheme" parent="@style/Theme.Design.Light.BottomSheetDialog"/>
```

#### 2\. サブクラスの実装

`BottomSheetDialogFragment`を継承したクラスを作成する。
このクラスのコンストラクタにはダイアログのコンテンツとなるレイアウトファイルのリソースIDを指定しておく。

```kotlin
import com.google.android.material.bottomsheet.BottomSheetDialogFragment
import com.google.android.material.bottomsheet.BottomSheetDialog
import android.app.Dialog
import android.os.Bundle

class CustomBottomSheetDialogFragment :
    BottomSheetDialogFragment(R.layout.fragment_bottom_sheet_dialog) {

    override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {
        return BottomSheetDialog(requireContext(), R.style.BottomSheetDialogTheme)
    }
}
```

ダイアログで表示するためのレイアウトファイル`fragment_bottom_sheet_dialog.xml`も作成しておく。

```xml
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <TextView
        android:gravity="center"
        android:padding="16dp"
        android:layout_width="match_parent"
        android:layout_height="100dp"
        android:text="hello_world!!"/>

</FrameLayout>
```

以下のコードでダイアログを表示できる。

```kotlin
import androidx.appcompat.app.AppCompatActivity

class MainActivity : AppCompatActivity() {

  ...

  fun showDialog() {
    val dialog = CustomBottomSheetDialogFragment()
    dialog.show(supportFragmentManager, null)
  }
}
```

## ナビゲーションバーの表示を調整する

デフォルトではナビゲーションバーが透過して表示されることがあるので、`style`に`android:windowIsFloating="false"`を設定する。

```xml
<style name="BottomSheetDialogTheme" parent="@style/Theme.Design.Light.BottomSheetDialog">
    <item name="android:windowIsFloating">false</item>
</style>
```

さらにダイアログの背景色とナビゲーションバーの色を合わせたい場合は、以下のように設定する。

```xml
<style name="BottomSheet" parent="@style/Widget.Design.BottomSheet.Modal">
    <item name="android:background">@android:color/darker_gray</item>
</style>

<style name="BottomSheetDialogTheme" parent="@style/Theme.Design.Light.BottomSheetDialog">
    <item name="android:windowIsFloating">false</item>
    <item name="android:navigationBarColor">@android:color/darker_gray</item>
    <item name="bottomSheetStyle">@style/BottomSheet</item>
</style>
```

## 最初に表示される高さを調整する

**`BottomSheetBehavior`**を使う。`Activity`のレイアウトが`CoordinatorLayout`でないと使えないため注意。

ダイアログが表示されるタイミングで`BottomSheetBehavior`を取得し、`peekHeight`と`state`を設定する。

```kotlin
import com.google.android.material.bottomsheet.BottomSheetBehavior

class CustomBottomSheetDialogFragment :
    BottomSheetDialogFragment(R.layout.fragment_bottom_sheet_dialog) {

    override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {
        return BottomSheetDialog(requireContext(), R.style.BottomSheetDialogTheme)
            .also { dialog ->
                dialog.setOnShowListener {
                    dialog.findViewById<View>(com.google.android.material.R.id.design_bottom_sheet)
                        ?.let {
                            val behavior = BottomSheetBehavior.from(it)
                            behavior.peekHeight =
                                resources.getDimensionPixelSize(R.dimen.bottom_sheet_dialog_initial_height)
                            behavior.state = BottomSheetBehavior.STATE_COLLAPSED
                        }
                }
            }
    }
}
```
