---
title: VBAでエクセル業務を効率化する
description: VBAによる開発手順を紹介・解説します。
navigation: true
draft: false
date: 2025-09-08T07:00:00+09:00
---

## VBAを扱う時に最初にやること

開発タブを表示させる。

`Excel`で`VBA`を扱う場合、「開発」タブを表示させる必要があります。以下の手順で設定できる。

`ファイル` > `オプション` > `リボンの設定` > `開発` にチェックを入れる

### 参考

* [【初心者必見】エクセルVBAで最初にすべき6つの設定](https://www.excelspeedup.com/vbapuroguramusaisyo/)

## 変数の初期化

`Dim`による変数宣言と値の設定は、コロン（`:`）を使って1行で記述できる。

```vb
Dim numberValue As Integer: numberValue = 30000
Dim text As String: text = "sample text"
```


## VBAにおけるセルとワークシートを参照する

基本的な参照方法として、`Cells`と`Range`の2つがある。

### Cells を使ったセル参照

`Cells` は、行と列のインデックス（番号または列名）を使ってセルを指定する方法。

```vb
' 行番号と列番号で指定
Cells(1, 1) = "A1に値を設定します"
' 行番号と列名で指定
Cells(1, "A") = "A1に値を設定します"
' 単一のセルを指定
Cells(2, 1) = "A2に値を設定します"
' 行と列を番号と列名で指定
Cells(4, "D") = "D4に値を設定します"
```

### Range を使ったセル参照

`Range`は、Excelのセル名（例: "A1"）や範囲（例: "A1:B2"）を使ってセルを指定する方法。
`Range`は単一のセルだけでなく、複数のセルや列全体・行全体も指定できる。

```vb
' 単一のセルを指定
Range("A1") = "A1に値を設定します"
' 複数のセルをカンマで区切って指定
Range("A2,D2") = "A2,D2に値を設定します"
' 連続したセル範囲を指定
Range("A3:D3") = "A3～D3 (=A3,B3,C3,D3)に値を設定します"
' A列からD列のすべてのセルを指定
Range("A:D") = "A～D列(=A,B,C,D列のすべてのセル)に値を設定します"
' 1行目から4行目のすべてのセルを指定
Range("1:4") = "1～4行(=1,2,3,4行のすべてのセル)に値を設定します"
' A2からC3までのセル範囲を指定
Range("A2:C3") = "A2～C3(=A2,A3,B2,B3,C2,C3)に値を設定します"
```

### 参考

  * [Excel VBA セルやセル範囲の選択や参照をするメソッドとプロパティ](https://kosapi.com/post-2777/)
  * [Range.Cells プロパティ (Excel)](https://learn.microsoft.com/ja-jp/office/vba/api/excel.range.cells)
  * [Range オブジェクト (Excel)](https://learn.microsoft.com/ja-jp/office/vba/api/excel.range\(object\))
  

## ワークシートを参照する

VBAでワークシートを参照する主な方法は2つ。

### インデックスによる参照

ワークシートのインデックス番号（1から始まる順番）を使って参照する。

```vb
' アプリケーションのすべてのワークシートからインデックスで参照
Application.Worksheets(Index)

' 特定のブック内のワークシートをインデックスで参照
Workbook.Worksheets(Index)
```

### ワークシート名による参照

ワークシートの名前（例：「Sheet1」や「売上データ」など）を使って参照する。

```vb
' アプリケーションのすべてのワークシートから名前で参照
Application.Worksheets("SheetName")

' 特定のブック内のワークシートを名前で参照
Workbook.Worksheets("SheetName")
```


### 参考

  * [VBAでワークシートを参照する](https://vbabeginner.net/browse-worksheets/)

## VBAで現在日時を取得する

### 日付のみを取得する

日付だけを取得する場合、`Date` 関数を使う。

```vb
Dim date As Date: date = Date()
```

-----

### 時刻も含めて取得する

時刻も合わせて取得したい場合、\*\*`Now`\*\*関数を使う。

```vb
Dim now As Date: now = Now()
```

### 参考

  * [VBA – 今日の日付（現在の日付）を取得する](https://www.automateexcel.com/ja/vba/todays-current-date-ja/)


## 外部と通信し、情報を取得したい

`XMLHTTP60`オブジェクトを使う。

基本的な実装サンプルは以下。

### サンプル

```vb
' HTTP通信オブジェクトを生成
Set http = New XMLHTTP60

' 取得対象のURLを指定
url = "取得対象となるリソースのURL"

' GETメソッドで同期通信をオープン
http.Open "GET", url, False

' リクエストを送信
http.send
```

### エラーハンドリング

通信が成功したかを確認するには、`http.statusText`プロパティが"OK"であるかをチェックする。

```vb
' HTTP通信オブジェクトを生成
Set http = New XMLHTTP60

' ...（上記と同様の通信処理）...

' エラーハンドリング
If http.statusText <> "OK" Then
    MsgBox "サーバーへの接続に失敗しました"
    Exit Sub
End If
```

### 取得したデータの解析

取得したデータの形式に応じて、解析方法を選択します。

#### XML形式の場合

`DOMDocument60`オブジェクトを使う。

```vb
' XML解析オブジェクトを生成
Set doc = New DOMDocument60

' 取得したレスポンステキストをXMLとして読み込む
doc.LoadXML (http.responseText)
```

#### JSON形式の場合

`JsonConverter`ライブラリを使う。

```vb
' JSONを解析し、オブジェクトに変換
Set jsonObj = JsonConverter.ParseJson(http.responseText)
```

### 参考

  * [ExcelVBAでHTTPアクセスしてXMLデータを取得する \#ExcelVBA - Qiita](https://qiita.com/isamusuzuki/items/b2e88184e7cfb75877a8)
  * [VBAで天気予報データをWebAPIで取得しJSONパースでエクセルへ出力](https://fastclassinfo.com/entry/vba_get_weather_information_with_json/#7JSON)